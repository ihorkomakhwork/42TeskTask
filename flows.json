[
    {
        "id": "412669072e03744e",
        "type": "tab",
        "label": "/alias",
        "disabled": false,
        "info": "",
        "env": [
            {
                "name": "VISA_AUTH_ID",
                "value": "XUODRN89PMITTDKCWHTJ21M862xJYdnMaV2B2ivXUZeGEB7bM",
                "type": "str"
            },
            {
                "name": "VISA_AUTH_PASSWORD",
                "value": "7S8ZTHJcr4B1QH",
                "type": "str"
            },
            {
                "name": "VISA_HOST",
                "value": "https://sandbox.api.visa.com/",
                "type": "str"
            }
        ]
    },
    {
        "id": "75217cfbf0795720",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "dfabc4eb4e54cb9a",
        "type": "tab",
        "label": "Flow 2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0127f0442eaff100",
        "type": "tab",
        "label": "/transaction",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e5a93a558b3c6776",
        "type": "tab",
        "label": "Onboarding",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2fc48cc339f00e42",
        "type": "tab",
        "label": "Error handler",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1c8cb1edd05e1ccb",
        "type": "subflow",
        "name": "visa api",
        "info": "",
        "category": "API",
        "in": [
            {
                "x": 60,
                "y": 220,
                "wires": [
                    {
                        "id": "c5ed5af6e10fedbd"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1280,
                "y": 140,
                "wires": [
                    {
                        "id": "c5ed5af6e10fedbd",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1320,
                "y": 240,
                "wires": [
                    {
                        "id": "c5ed5af6e10fedbd",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1160,
                "y": 320,
                "wires": [
                    {
                        "id": "c5ed5af6e10fedbd",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "Resource",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {},
        "color": "#359df3",
        "icon": "font-awesome/fa-credit-card-alt"
    },
    {
        "id": "3d8368539d02f074",
        "type": "subflow",
        "name": "json schema validator",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 80,
                "wires": [
                    {
                        "id": "9e44cfa7fa94eaa0"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 680,
                "y": 80,
                "wires": [
                    {
                        "id": "9e44cfa7fa94eaa0",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "schema",
                "type": "json",
                "value": "{}",
                "ui": {
                    "icon": "font-awesome/fa-list-alt",
                    "type": "input",
                    "opts": {
                        "types": [
                            "json"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#3FADB5",
        "icon": "node-red/parser-json.svg"
    },
    {
        "id": "0efdf64f7eaaebed",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "cert.pem",
        "keyname": "key_ca90416a-50ec-47f3-9a5d-f6f8e2b2d22c.pem",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "84e59769f7f05b82",
        "type": "tls-config",
        "name": "visa_config",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "cert.pem",
        "keyname": "privateKey.pem",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "c5ed5af6e10fedbd",
        "type": "http request",
        "z": "1c8cb1edd05e1ccb",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "{env.VISA_HOST}",
        "tls": "84e59769f7f05b82",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [
            {
                "keyType": "Content-Type",
                "keyValue": "",
                "valueType": "application/json",
                "valueValue": ""
            },
            {
                "keyType": "Accept",
                "keyValue": "",
                "valueType": "application/json",
                "valueValue": ""
            }
        ],
        "x": 410,
        "y": 220,
        "wires": [
            [
                "343dec3e360d3a6a"
            ]
        ]
    },
    {
        "id": "343dec3e360d3a6a",
        "type": "debug",
        "z": "1c8cb1edd05e1ccb",
        "name": "log",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 120,
        "wires": []
    },
    {
        "id": "9e44cfa7fa94eaa0",
        "type": "function",
        "z": "3d8368539d02f074",
        "name": "alias validation",
        "func": "const ajv = new Ajv();\n\nconst schema = env.get('schema');\nconst validate = ajv.compile(schema);\n\nif (validate(msg.payload)) return msg;\nelse node.error(\"Invalid massge\", msg);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "Ajv",
                "module": "ajv"
            }
        ],
        "x": 320,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "f83075e5cc12da3c",
        "type": "http in",
        "z": "412669072e03744e",
        "name": "[post] v1.0/alias",
        "url": "api/v1.0/alias",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 220,
        "wires": [
            [
                "0709cf8790772006"
            ]
        ],
        "icon": "font-awesome/fa-bank"
    },
    {
        "id": "0709cf8790772006",
        "type": "change",
        "z": "412669072e03744e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "req.body",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 220,
        "wires": [
            [
                "add41942c9b6ea29"
            ]
        ]
    },
    {
        "id": "add41942c9b6ea29",
        "type": "subflow:3d8368539d02f074",
        "z": "412669072e03744e",
        "name": "validate alias",
        "env": [
            {
                "name": "schema",
                "value": "{\"type\":\"object\",\"properties\":{\"aliasType\":{\"type\":\"string\",\"enum\":[\"PHONE\",\"EMAIL\"]},\"consent\":{\"type\":\"object\",\"properties\":{\"presenter\":{\"type\":\"string\"},\"version\":{\"type\":\"string\",\"minLength\":1,\"maxLength\":9,\"pattern\":\"^[0-9]+\\\\.[0-9]+$\"}},\"required\":[\"presenter\",\"version\"]},\"identification\":{\"type\":\"object\",\"properties\":{\"type\":{\"type\":\"string\",\"enum\":[\"PASSPORT\",\"DL\",\"NIDN\",\"DPI\"]},\"value\":{\"type\":\"string\",\"minLength\":1,\"maxLength\":36}},\"required\":[\"type\",\"value\"]},\"paymentCredentials\":{\"type\":\"array\",\"items\":{\"oneOf\":[{\"type\":\"integer\"},{\"type\":\"string\"}]}},\"tamplate\":{\"type\":\"object\",\"properties\":{},\"required\":[]}},\"allOf\":[{\"if\":{\"properties\":{\"aliasType\":{\"const\":\"EMAIL\"}}},\"then\":{\"properties\":{\"aliasValue\":{\"type\":\"string\",\"minLength\":1,\"maxLength\":128,\"pattern\":\"^([a-z0-9_\\\\.-]+)@([\\\\da-z\\\\.-]+)\\\\.([a-z\\\\.]{2,6})$\"}}}},{\"if\":{\"properties\":{\"aliasType\":{\"const\":\"PHONE\"}}},\"then\":{\"properties\":{\"aliasValue\":{\"type\":\"string\",\"minLength\":1,\"maxLength\":128,\"pattern\":\"^[1-9]+[0-9]*$\"}}}}],\"required\":[\"aliasType\",\"aliasValue\",\"consent\",\"identification\"]}",
                "type": "json"
            }
        ],
        "x": 630,
        "y": 220,
        "wires": [
            [
                "ea0feadba0c93e71"
            ]
        ]
    },
    {
        "id": "2f062a5572c1ac19",
        "type": "inject",
        "z": "412669072e03744e",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"aliasType\":\"PHONE\",\"aliasValue\":\"7657890765789765789657\",\"identification\":{\"type\":\"NIDN\",\"value\":\"A123456d\"},\"consent\":{\"presenter\":\"Wallmart\",\"version\":\"2.0\"},\"paymentCredentials\":[\"string\",1,\"string\",1]}",
        "payloadType": "json",
        "x": 190,
        "y": 280,
        "wires": [
            [
                "0709cf8790772006"
            ]
        ]
    },
    {
        "id": "4d4d480fadc22978",
        "type": "catch",
        "z": "412669072e03744e",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 160,
        "y": 420,
        "wires": [
            [
                "4b7d7fb79a291177"
            ]
        ]
    },
    {
        "id": "96d591075ce16a69",
        "type": "http request",
        "z": "412669072e03744e",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "84e59769f7f05b82",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 1030,
        "y": 220,
        "wires": [
            [
                "9ac105a7ce1bd126"
            ]
        ]
    },
    {
        "id": "8513a15eeda3a034",
        "type": "http response",
        "z": "412669072e03744e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1430,
        "y": 140,
        "wires": [],
        "icon": "font-awesome/fa-bank"
    },
    {
        "id": "cf0204ff01d91717",
        "type": "comment",
        "z": "412669072e03744e",
        "name": "",
        "info": "",
        "x": 1440,
        "y": 100,
        "wires": []
    },
    {
        "id": "9ac105a7ce1bd126",
        "type": "switch",
        "z": "412669072e03744e",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1210,
        "y": 220,
        "wires": [
            [
                "8513a15eeda3a034",
                "a65b29bfc0e63ea8"
            ]
        ]
    },
    {
        "id": "a65b29bfc0e63ea8",
        "type": "http response",
        "z": "412669072e03744e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1430,
        "y": 300,
        "wires": [],
        "icon": "font-awesome/fa-bank"
    },
    {
        "id": "ee35a1d69279ea44",
        "type": "comment",
        "z": "412669072e03744e",
        "name": "",
        "info": "",
        "x": 1440,
        "y": 260,
        "wires": []
    },
    {
        "id": "4b7d7fb79a291177",
        "type": "debug",
        "z": "412669072e03744e",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 360,
        "y": 440,
        "wires": []
    },
    {
        "id": "ea0feadba0c93e71",
        "type": "debug",
        "z": "412669072e03744e",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 820,
        "y": 220,
        "wires": []
    },
    {
        "id": "429f2ffb076cd474",
        "type": "link in",
        "z": "2fc48cc339f00e42",
        "name": "link in 1",
        "links": [],
        "x": 155,
        "y": 200,
        "wires": [
            [
                "dd4c08856d5b724b"
            ]
        ]
    },
    {
        "id": "dd4c08856d5b724b",
        "type": "debug",
        "z": "2fc48cc339f00e42",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 300,
        "y": 200,
        "wires": []
    }
]