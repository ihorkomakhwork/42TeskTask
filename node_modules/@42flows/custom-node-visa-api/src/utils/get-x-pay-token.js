const crypto = require('crypto');

const { visaApiEnvConfig } = require('../config');

/**
 * @param {Object} data
 * @param data.body
 * @param data.resourcePath
 * @returns {string}
 */
function getXPayToken({ body, resourcePath }) {
  const postBody = JSON.stringify(body);
  const timestamp = Math.floor(Date.now() / 1000);
  const env = visaApiEnvConfig();
  const preHashString = `${timestamp + resourcePath}apikey=${
    env.API_KEY
  }${postBody}`;

  const hashString = crypto
    .createHmac('SHA256', env.SHARED_SECRET)
    .update(preHashString)
    .digest('hex');

  return `xv2:${timestamp}:${hashString}`;
}

module.exports = { getXPayToken };
